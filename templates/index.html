<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CareerCompass – AI Career Report</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --chelsea-blue: #034694;
      --chelsea-blue-dark: #012b7b;
      --text-main: #111827;
      --text-muted: #6b7280;
      --border-subtle: #e5e7eb;
      --error-red: #dc2626;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at top, rgba(3, 70, 148, 0.06), transparent 55%),
        #f3f4f6;
      color: var(--text-main);
      line-height: 1.5;
    }

    /* When modal is open, lock scroll */
    body.cc-locked {
      overflow: hidden;
    }

    .page {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .card {
      width: 100%;
      max-width: 1040px;
      background: linear-gradient(
        to bottom right,
        rgba(3, 70, 148, 0.035),
        #ffffff 45%,
        #ffffff 100%
      );
      border-radius: 20px;
      border: 1px solid rgba(15, 23, 42, 0.04);
      box-shadow:
        0 18px 40px rgba(15, 23, 42, 0.10),
        0 0 0 1px rgba(255, 255, 255, 0.9);
      padding: 34px 32px;
    }

    .card form {
      display: grid;
      grid-template-columns: 1.45fr 1fr;
      gap: 30px;
    }

    @media (max-width: 900px) {
      .card form {
        grid-template-columns: 1fr;
      }
    }

    .left {
      border-right: 1px solid var(--border-subtle);
      padding-right: 30px;
      display: flex;
      flex-direction: column;
    }

    @media (max-width: 900px) {
      .left {
        border-right: none;
        border-bottom: 1px solid var(--border-subtle);
        padding-bottom: 20px;
      }
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      background: var(--chelsea-blue);
      color: white;
      padding: 6px 14px;
      border-radius: 999px;
      margin-bottom: 18px;
      box-shadow: 0 6px 14px rgba(3, 70, 148, 0.35);
    }

    .badge-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #22c55e;
    }

    .title {
      font-size: 32px;
      font-weight: 750;
      margin: 0 0 10px;
      color: var(--chelsea-blue);
    }

    .subtitle {
      font-size: 15px;
      margin-bottom: 22px;
      color: var(--text-muted);
    }

    .hint-list {
      font-size: 14px;
      margin: 0;
      padding-left: 18px;
    }

    .hint-list li {
      margin-bottom: 10px;
    }

    .email-block {
      margin-top: auto;
      padding-top: 20px;
      border-top: 1px dashed var(--border-subtle);
    }

    .trust-text {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .trust-text strong {
      color: var(--chelsea-blue);
    }

    .right {
      padding-left: 6px;
    }

    label {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
      display: block;
    }

    input[type="email"] {
      width: 100%;
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      font-size: 13px;
    }

    input[type="email"]:focus {
      border-color: var(--chelsea-blue);
      outline: none;
      box-shadow: 0 0 0 1px rgba(3, 70, 148, 0.25);
    }

    textarea {
      width: 100%;
      min-height: 170px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid #d1d5db;
      background: #f9fafb;
      font-size: 13px;
      resize: vertical;
    }

    textarea:focus {
      border-color: var(--chelsea-blue);
      background: #ffffff;
      outline: none;
      box-shadow: 0 0 0 1px rgba(3, 70, 148, 0.25);
    }

    .file-input {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      font-size: 13px;
    }

    .helper-text {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 4px;
    }

    .or-divider {
      text-align: center;
      color: #9ca3af;
      font-size: 12px;
    }

    .actions {
      margin-top: 12px;
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .btn-primary {
      padding: 11px 22px;
      border-radius: 999px;
      background: var(--chelsea-blue);
      color: white;
      font-weight: 600;
      cursor: pointer;
      border: none;
      box-shadow: 0 10px 20px rgba(3, 70, 148, 0.35);
      transition: 0.15s ease;
    }

    .btn-primary.disabled {
      opacity: 0.5;
      cursor: not-allowed;
      box-shadow: none;
    }

    .input-error {
      border-color: var(--error-red) !important;
      box-shadow: 0 0 0 1px rgba(220, 38, 38, 0.25) !important;
    }

    /* Loading overlay */
    #loading-overlay {
      position: fixed;
      inset: 0;
      background: rgba(255, 255, 255, 0.88);
      backdrop-filter: blur(4px);
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      z-index: 9999;
      text-align: center;
    }

    #loading-overlay .spinner {
      width: 54px;
      height: 54px;
      border-radius: 50%;
      border: 5px solid #d1e3fb;
      border-top-color: var(--chelsea-blue);
      animation: spin 0.9s linear infinite;
      margin-bottom: 18px;
    }

    #loading-overlay p {
      margin: 0;
      font-size: 16px;
      font-weight: 600;
      color: var(--chelsea-blue-dark);
    }

    #loading-overlay span {
      display: block;
      margin-top: 6px;
      font-size: 13px;
      color: var(--text-muted);
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to   { transform: rotate(360deg); }
    }

    /* Privacy / data use modal overlay */
    .cc-modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9998;
    }

    .cc-modal-overlay.cc-visible {
      display: flex;
    }

    .cc-modal {
      background: #ffffff;
      max-width: 480px;
      width: 90%;
      border-radius: 10px;
      padding: 24px 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.18);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    .cc-modal h2 {
      font-size: 1.3rem;
      margin-bottom: 10px;
    }

    .cc-modal p {
      font-size: 0.9rem;
      line-height: 1.5;
      margin-bottom: 12px;
    }

    .cc-modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 16px;
    }

    .cc-btn {
      border: none;
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 0.9rem;
      cursor: pointer;
    }

    .cc-btn-primary {
      background: #111827;
      color: #ffffff;
    }

    .cc-btn-secondary {
      background: #e5e7eb;
      color: #111827;
    }

    .cc-btn-primary:hover {
      opacity: 0.9;
    }

    .cc-btn-secondary:hover {
      background: #d1d5db;
    }
  </style>
</head>

<body>
  <!-- Privacy / Data Use Modal -->
  <div id="cc-privacy-overlay" class="cc-modal-overlay">
    <div class="cc-modal">
      <h2>Before You Continue</h2>
      <p>
        CareerCompass analyses the information you provide to generate your personalised career report.
        By continuing, you agree that your CV, email address, and any other submitted information may
        be used for generating your report, improving the product, and future communications related
        to CareerCompass.
      </p>
      <p style="font-size: 0.85rem; color: #4b5563;">
        If you do not agree, please exit the site and do not submit your information.
      </p>

      <div class="cc-modal-actions">
        <button type="button" id="cc-privacy-exit" class="cc-btn cc-btn-secondary">
          Exit
        </button>
        <button type="button" id="cc-privacy-accept" class="cc-btn cc-btn-primary">
          Agree &amp; Continue
        </button>
      </div>
    </div>
  </div>

  <div class="page">
    <div class="card">
      <form method="POST" action="/generate" enctype="multipart/form-data">

        <!-- LEFT SIDE -->
        <div class="left">
          <div>
            <div class="badge">
              <span class="badge-dot"></span>
              Instant AI-powered career report
            </div>

            <h1 class="title">CareerCompass</h1>
            <p class="subtitle">Turn your CV into a realistic, personalised career report in seconds.</p>

            <ul class="hint-list">
              <li>Paste your CV or upload it as a file</li>
              <li>We analyse your experience and skills</li>
              <li>Get a structured report with roles, strengths, gaps, and a 90-day plan</li>
            </ul>
          </div>

          <!-- Email field in bottom-left -->
          <div class="email-block">
            <div class="trust-text">
              <strong>Please enter your email to enable generation of your report.</strong><br>
              You may receive occasional updates on the project.
            </div>

            <label for="email">Email address</label>
            <input id="email" name="email" type="email" placeholder="you@example.com" required>
            <div class="helper-text">Please enter your email to enable generation of your report.</div>
          </div>
        </div>

        <!-- RIGHT SIDE -->
        <div class="right">
          <h2>Upload your CV</h2>
          <p>Use either option below.</p>

          <label for="cv_text">CV text & supplementary information</label>
          <textarea id="cv_text" name="cv_text" placeholder="Paste your CV or add extra information..."></textarea>
          <div class="helper-text">You can paste your full CV here or use this instead of uploading a file.</div>

          <div class="or-divider">— or —</div>

          <label for="cv_file">Upload your CV file</label>
          <input id="cv_file" name="cv_file" type="file" accept=".pdf,.doc,.docx,.txt" class="file-input">
          <div class="helper-text">Supported: PDF, DOC, DOCX, TXT.</div>

          <div class="actions">
            <button type="submit" class="btn-primary disabled" disabled>Generate career report →</button>
          </div>
        </div>

      </form>
    </div>
  </div>

  <!-- Loading overlay -->
  <div id="loading-overlay">
    <div class="spinner"></div>
    <p>Generating your career report…</p>
    <span>This usually takes up to 45 seconds.</span>
  </div>

  <!-- LIVE VALIDATION + PRIVACY GATE + LOADING -->
  <script>
    const button = document.querySelector(".btn-primary");
    const emailInput = document.getElementById("email");
    const cvText = document.getElementById("cv_text");
    const cvFile = document.getElementById("cv_file");
    const form = document.querySelector("form");
    const loadingOverlay = document.getElementById("loading-overlay");

    // Privacy modal elements
    const STORAGE_KEY = "cc_privacy_accepted_v1";
    const overlay = document.getElementById("cc-privacy-overlay");
    const acceptBtn = document.getElementById("cc-privacy-accept");
    const exitBtn = document.getElementById("cc-privacy-exit");

    let privacyAccepted = false;

    function openPrivacyModal() {
      if (!overlay) return;
      overlay.classList.add("cc-visible");
      document.body.classList.add("cc-locked");
    }

    function closePrivacyModal() {
      if (!overlay) return;
      overlay.classList.remove("cc-visible");
      document.body.classList.remove("cc-locked");
    }

    function validateForm() {
      const emailValid = /^\S+@\S+\.\S+$/.test(emailInput.value.trim());
      const hasText = cvText.value.trim().length > 0;
      const hasFile = cvFile.files.length > 0;
      const cvValid = hasText || hasFile;

      // Email validation
      if (!emailValid) emailInput.classList.add("input-error");
      else emailInput.classList.remove("input-error");

      // CV validation
      if (!cvValid) {
        cvText.classList.add("input-error");
        cvFile.classList.add("input-error");
      } else {
        cvText.classList.remove("input-error");
        cvFile.classList.remove("input-error");
      }

      // Enable/disable button (also require privacyAccepted)
      if (emailValid && cvValid && privacyAccepted) {
        button.disabled = false;
        button.classList.remove("disabled");
      } else {
        button.disabled = true;
        button.classList.add("disabled");
      }
    }

    // Field listeners
    emailInput.addEventListener("input", validateForm);
    cvText.addEventListener("input", validateForm);
    cvFile.addEventListener("change", validateForm);

    // Initial setup once DOM is ready
    document.addEventListener("DOMContentLoaded", function () {
      privacyAccepted = localStorage.getItem(STORAGE_KEY) === "true";

      if (!privacyAccepted) {
        openPrivacyModal();
      }

      // Ensure correct initial state
      validateForm();
    });

    // Handle "Agree & Continue"
    if (acceptBtn) {
      acceptBtn.addEventListener("click", function () {
        privacyAccepted = true;
        localStorage.setItem(STORAGE_KEY, "true");
        closePrivacyModal();
        validateForm(); // re-check now that privacy is accepted
      });
    }

    // Handle "Exit" (send them away)
    if (exitBtn) {
      exitBtn.addEventListener("click", function () {
        window.location.href = "https://google.com";
      });
    }

    // Show loading overlay on submit (only when button is actually enabled)
    form.addEventListener("submit", () => {
      if (!button.disabled) {
        loadingOverlay.style.display = "flex";
      }
    });
  </script>

</body>
</html>
